{
  "project": "PolicyPilot",
  "last_updated": "2026-02-05",
  "notes": "Coding agents may ONLY change the 'passes' field. Do not add, remove, or redefine features.",

  "phases": [
    {
      "id": "spike",
      "name": "Day 0 Spike",
      "description": "Validate Agent Studio feasibility. Go/no-go gate."
    },
    {
      "id": "data",
      "name": "Data & Agent",
      "description": "Full policy dataset + tuned Agent Studio agent that nails all 4 scenarios."
    },
    {
      "id": "foundation",
      "name": "Frontend Foundation",
      "description": "Project scaffolding, parser, API proxy — no UI yet."
    },
    {
      "id": "ui",
      "name": "UI Components",
      "description": "All visual components. Build with mock data first, wire live later."
    },
    {
      "id": "integration",
      "name": "Integration",
      "description": "Connect frontend to live Agent Studio API. End-to-end verification."
    },
    {
      "id": "ship",
      "name": "Deploy & Submit",
      "description": "Vercel deployment, polish, dev.to submission post."
    }
  ],

  "features": [
    {
      "id": "F01",
      "phase": "spike",
      "category": "infrastructure",
      "description": "Create Algolia account, index, and push 5-6 test policy records",
      "steps": [
        "Create Algolia account on Free Build plan",
        "Create index named 'apex_gear_policies'",
        "Configure searchable attributes: text, clause_title, policy_name, applies_to, conditions",
        "Configure faceting attributes: policy_type, policy_layer, applies_to, product_tags, effect",
        "Configure custom ranking: desc(policy_layer), desc(priority), desc(specificity_score)",
        "Push 5-6 test policy records matching the PolicyRecord schema",
        "Verify records are searchable via Algolia dashboard",
        "Run a test search with filters (e.g., policy_type:warranty AND product_tags:fitness) and confirm correct results"
      ],
      "passes": false
    },
    {
      "id": "F02",
      "phase": "spike",
      "category": "infrastructure",
      "description": "Configure Agent Studio agent with system prompt v1 and validate basic functionality",
      "steps": [
        "Create Agent Studio agent in Algolia dashboard",
        "Add Algolia Search tool pointing to apex_gear_policies index",
        "Configure LLM provider (try Algolia's free GPT-4.1 first, fall back to own OpenAI key)",
        "Set temperature to 0",
        "Write system prompt v1 with XML output format and conflict-resolution protocol",
        "Publish the agent",
        "Send a test query via /completions API and confirm a response is returned"
      ],
      "passes": false
    },
    {
      "id": "F03",
      "phase": "spike",
      "category": "validation",
      "description": "Validate multi-step retrieval, XML output, and response structure",
      "steps": [
        "Send the treadmill scenario query ('Pro-Treadmill motor failure at 45 days')",
        "Log the FULL raw /completions response including all parts and types",
        "Document all observed 'parts' types (step-start, text, tool-call, etc.)",
        "Confirm agent makes multiple Algolia Search calls (general policy + product warranty)",
        "Confirm response contains valid XML tags (<analysis>, <verdict>, <policies>, etc.)",
        "Run the same query 5 times and confirm verdict is APPROVED every time",
        "Confirm the agent cites clause_id values from actual index records (not hallucinated)",
        "Attempt to parse the XML output programmatically and log success/failure",
        "If multi-step retrieval fails: test fallback approach (single broad query with custom ranking)"
      ],
      "passes": false
    },
    {
      "id": "F04",
      "phase": "data",
      "category": "data",
      "description": "Create and push full policy dataset (~25-35 records) to Algolia",
      "steps": [
        "Write all store-wide policies (5-6 records): general returns, exchanges, refunds, shipping",
        "Write all category warranties (4-5 records): electronics, fitness, outdoor, audio",
        "Write all product-specific warranties (4-5 records): Pro-Treadmill, SoundPro earbuds, etc.",
        "Write all situational overrides (4-5 records): hygiene, shipping damage, recall, defective",
        "Write red herring policies (3-4 records): loyalty member extension, expired holiday special, bulk discount",
        "Validate every record conforms to PolicyRecord TypeScript interface",
        "Validate all objectIDs are unique",
        "Validate all clause_ids are unique and follow consistent naming (e.g., RET-1.1, WAR-3.2)",
        "Push all records to Algolia apex_gear_policies index",
        "Verify total record count in Algolia dashboard matches expected count",
        "Run test searches confirming each demo scenario's relevant policies are retrievable"
      ],
      "passes": false
    },
    {
      "id": "F05",
      "phase": "data",
      "category": "agent",
      "description": "Tune system prompt until all 4 demo scenarios produce correct, consistent XML output",
      "steps": [
        "Test Scenario 1 (Warranty Override): confirm verdict=APPROVED, conflict detected, warranty wins",
        "Test Scenario 2 (Hygiene Block): confirm verdict=DENIED, conflict detected, hygiene wins",
        "Test Scenario 3 (Damage Override): confirm verdict=APPROVED, conflict detected, damage override wins",
        "Test Scenario 4 (Clean Approval): confirm verdict=APPROVED, no conflict detected",
        "Run each scenario 5 times — all runs must produce the same verdict",
        "Confirm all cited clause_ids exist in the index (no hallucinations)",
        "Confirm agent never asks clarifying questions (all outputs are decisive)",
        "Confirm red herring policies are retrieved but correctly dismissed or not cited",
        "Confirm XML output is parseable for all 4 scenarios (no malformed tags)",
        "Save the final system prompt to the repo as system-prompt.md"
      ],
      "passes": false
    },
    {
      "id": "F06",
      "phase": "foundation",
      "category": "infrastructure",
      "description": "Next.js project scaffolding with Tailwind CSS and environment config",
      "steps": [
        "Initialize Next.js project (App Router) with TypeScript",
        "Install and configure Tailwind CSS",
        "Create .env.example with ALGOLIA_APP_ID, ALGOLIA_API_KEY, ALGOLIA_AGENT_ID placeholders",
        "Create .env.local with real values (gitignored)",
        "Add .env.local to .gitignore",
        "Verify 'npm run dev' starts the dev server on localhost:3000",
        "Verify a basic page renders at localhost:3000"
      ],
      "passes": false
    },
    {
      "id": "F07",
      "phase": "foundation",
      "category": "functional",
      "description": "XML response parser with typed output and fallback handling",
      "steps": [
        "Create src/lib/parser.ts with parseVerdictResponse(raw: string): ParsedVerdict | null",
        "Implement XML tag extraction for all fields: verdict, verdict_type, summary, policies, conflict, resolution, recommended_action",
        "Handle malformed/missing XML gracefully — return null, never throw",
        "Create src/lib/parser.test.ts with test cases",
        "Test: valid XML from Scenario 1 (warranty override) parses correctly",
        "Test: valid XML from Scenario 4 (clean approval, no conflict) parses correctly",
        "Test: malformed XML returns null",
        "Test: empty string returns null",
        "Test: XML with extra whitespace/newlines parses correctly",
        "All tests pass"
      ],
      "passes": false
    },
    {
      "id": "F08",
      "phase": "foundation",
      "category": "functional",
      "description": "API route proxy /api/analyze that calls Agent Studio /completions",
      "steps": [
        "Create src/app/api/analyze/route.ts",
        "Accept POST request with { ticketText: string } body",
        "Call Algolia Agent Studio /completions endpoint server-side",
        "Forward the response back to the client",
        "Set 30-second timeout on the fetch call",
        "Return 500 with error message on failure",
        "Return 504 on timeout",
        "Verify via curl: POST /api/analyze with treadmill ticket text returns a response",
        "Verify API keys are NOT exposed in the client-side bundle"
      ],
      "passes": false
    },
    {
      "id": "F09",
      "phase": "ui",
      "category": "ui",
      "description": "Left panel: ticket queue with 4 pre-loaded demo tickets",
      "steps": [
        "Create src/data/tickets.ts with all 4 demo ticket objects (subject, customer, product, purchase date, message)",
        "Create TicketQueue component showing all 4 tickets as selectable cards",
        "Each card shows: subject line, customer name, product name",
        "Clicking a ticket sets it as 'selected' (visual highlight)",
        "Selected ticket ID is lifted to parent state for the right panel to consume",
        "Only one ticket can be selected at a time",
        "Visual design: clean card list with hover and active states",
        "Verify all 4 tickets render correctly and are clickable"
      ],
      "passes": false
    },
    {
      "id": "F10",
      "phase": "ui",
      "category": "ui",
      "description": "Right panel: empty/onboarding state with judge instructions",
      "steps": [
        "When no ticket is selected, right panel shows onboarding content",
        "Display PolicyPilot name/logo",
        "Display 1-2 sentence explanation: what it does and who it's for",
        "Display instruction: 'Select a support ticket to see PolicyPilot analyze it'",
        "Display brief 'How It Works' steps: 1) Retrieves relevant policies 2) Detects conflicts 3) Resolves and recommends",
        "Display 'Powered by Algolia Agent Studio' attribution",
        "Verify the empty state renders when page first loads"
      ],
      "passes": false
    },
    {
      "id": "F11",
      "phase": "ui",
      "category": "ui",
      "description": "Right panel: loading state with skeleton UI",
      "steps": [
        "When a ticket is selected and analysis is in progress, show loading state",
        "Display skeleton/shimmer placeholders matching the shape of verdict + policy cards",
        "Display animated text: 'Analyzing ticket against policy database...'",
        "Loading state appears immediately on ticket click (no delay)",
        "Verify loading state renders when analysis is triggered (use a mock delayed response)"
      ],
      "passes": false
    },
    {
      "id": "F12",
      "phase": "ui",
      "category": "ui",
      "description": "Right panel: verdict display card with summary and recommended action",
      "steps": [
        "Create VerdictCard component consuming ParsedVerdict data",
        "Display verdict badge: green 'APPROVED', red 'DENIED', or yellow 'ESCALATE'",
        "Display verdict_type as a subtitle (e.g., 'Warranty Claim')",
        "Display summary text",
        "Display recommended_action as a distinct call-to-action section",
        "Verify with mock ParsedVerdict data for APPROVED, DENIED, and ESCALATE cases",
        "Visual design: clear hierarchy, verdict badge is prominent"
      ],
      "passes": false
    },
    {
      "id": "F13",
      "phase": "ui",
      "category": "ui",
      "description": "Right panel: policy comparison cards with win/lose indicators",
      "steps": [
        "Create PolicyCards component consuming ParsedVerdict.policies array",
        "Each policy card shows: clause_id, policy_name, effect, reason",
        "Cards with applies=true get a green check / 'Applies' indicator",
        "Cards with applies=false get a red X / 'Overridden' indicator",
        "The winning policy card (matching resolution.winningPolicy) has a distinct 'Winner' badge",
        "Verify with mock data: 2 policies where one wins and one is overridden",
        "Verify with mock data: 1 policy with no conflict (scenario 4)",
        "Visual design: cards are side-by-side or stacked with clear contrast"
      ],
      "passes": false
    },
    {
      "id": "F14",
      "phase": "ui",
      "category": "ui",
      "description": "Right panel: conflict resolution trace",
      "steps": [
        "Create ConflictTrace component consuming ParsedVerdict.conflict and ParsedVerdict.resolution",
        "When conflict.exists=true: display conflict description and resolution rule_applied",
        "When conflict.exists=false: display 'No conflict detected' with a neutral indicator",
        "Resolution section shows which policy won and why (rule_applied text)",
        "Verify with mock data: conflict scenario shows full trace",
        "Verify with mock data: no-conflict scenario shows clean message"
      ],
      "passes": false
    },
    {
      "id": "F15",
      "phase": "ui",
      "category": "ui",
      "description": "Right panel: error, timeout, and parse failure states",
      "steps": [
        "Error state: display friendly card 'Analysis failed' with retry button",
        "Timeout state (30s): display 'Analysis is taking longer than expected' with retry button",
        "Parse failure state: display raw LLM response in formatted panel with yellow warning banner",
        "Retry button re-triggers analysis for the currently selected ticket",
        "Verify error state renders when API returns 500",
        "Verify timeout state renders when API returns 504",
        "Verify parse failure state renders when parser returns null"
      ],
      "passes": false
    },
    {
      "id": "F16",
      "phase": "ui",
      "category": "ui",
      "description": "Algolia visibility elements: retrieval time and attribution",
      "steps": [
        "Display retrieval/processing time after successful analysis (e.g., 'Analysis completed in 3.2s')",
        "Display 'Powered by Algolia Agent Studio' badge in the right panel footer",
        "Time measurement starts when ticket is clicked, ends when response is parsed",
        "Verify time displays correctly after a successful analysis"
      ],
      "passes": false
    },
    {
      "id": "F17",
      "phase": "integration",
      "category": "integration",
      "description": "Wire frontend to live Agent Studio API and verify all 4 scenarios end-to-end",
      "steps": [
        "Clicking a ticket triggers POST /api/analyze with the ticket text",
        "Loading state shows while waiting for response",
        "Response is parsed via parseVerdictResponse and rendered in UI components",
        "Scenario 1 (Treadmill): shows APPROVED, warranty vs return conflict, warranty wins",
        "Scenario 2 (Earbuds): shows DENIED, return vs hygiene conflict, hygiene wins",
        "Scenario 3 (Hiking Boots): shows APPROVED, return vs damage override conflict, damage wins",
        "Scenario 4 (Backpack): shows APPROVED, no conflict, standard return",
        "All 4 scenarios render correctly with no console errors",
        "Switching between tickets clears previous result and shows loading state",
        "Re-clicking the same ticket re-triggers analysis"
      ],
      "passes": false
    },
    {
      "id": "F18",
      "phase": "ship",
      "category": "deployment",
      "description": "Deploy to Vercel with environment variables and verify live URL",
      "steps": [
        "Push code to GitHub repository",
        "Connect repo to Vercel",
        "Set environment variables in Vercel dashboard: ALGOLIA_APP_ID, ALGOLIA_API_KEY, ALGOLIA_AGENT_ID",
        "Trigger deployment",
        "Verify live URL loads and renders the ticket queue",
        "Verify all 4 scenarios work on the live URL (not just localhost)",
        "Verify API route works (not blocked by Vercel serverless config)",
        "Verify no API keys are exposed in client-side JavaScript (check page source)"
      ],
      "passes": false
    },
    {
      "id": "F19",
      "phase": "ship",
      "category": "deployment",
      "description": "Visual polish and responsive design pass",
      "steps": [
        "Review entire UI for visual consistency (spacing, colors, typography)",
        "Ensure the layout works on common screen sizes (1280px+, 1440px, 1920px)",
        "Ensure verdict badge colors are accessible (sufficient contrast)",
        "Ensure all text is readable (no truncation, no overflow)",
        "Ensure all interactive elements have hover/focus states",
        "Final screenshot of each scenario for the submission post"
      ],
      "passes": false
    },
    {
      "id": "F20",
      "phase": "ship",
      "category": "submission",
      "description": "Write and publish dev.to submission post",
      "steps": [
        "Use the Non-Conversational track submission template",
        "Section: 'What I Built' — overview of PolicyPilot, workflow it enhances, proactive assistance",
        "Section: 'Demo' — live URL link + screenshots of all 4 scenarios",
        "Section: 'How I Used Algolia Agent Studio' — data indexed, retrieval approach, prompt engineering details",
        "Section: 'Why Fast Retrieval Matters' — how Algolia's speed improves the support agent workflow",
        "Include architecture diagram or explanation of the Agent Studio pipeline",
        "Include code snippets showing key implementation details",
        "Proofread for clarity and completeness",
        "Publish post on dev.to before 11:59 PM PST Feb 8"
      ],
      "passes": false
    }
  ]
}
