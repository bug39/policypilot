POLICYPILOT — PROGRESS LOG
Last updated: 2026-02-05
Current phase: ship (Day 3)
Next feature to work on: F21 (deploy), F23 (submission)

===

SESSION 1 — 2026-02-05 (Day 0, Planning)

COMPLETED:
- Read hackathon brief (hackathon.md) and rough idea (rough_idea.md)
- Researched Algolia Agent Studio capabilities, API, tools, pricing
- Researched Algolia search/indexing features (filters, custom ranking, facets)
- Researched competitive landscape (~15+ existing submissions analyzed)
- Validated idea is technically feasible on Algolia Free Build plan
- Validated idea is novel (no conflict-resolution agents in current submissions)
- Wrote comprehensive SPEC.md covering architecture, UX, data model, scope
- Ran two independent audits (hackathon compliance + technical gaps)
- Fixed all FAIL/CRITICAL audit findings in SPEC.md v2:
  - Added submission template requirements (4 required dev.to sections)
  - Added judge-facing instructions plan
  - Defined complete PolicyRecord TypeScript schema
  - Defined XML structured output format with ParsedVerdict type
  - Locked API architecture (Next.js API route proxy)
  - Locked LLM provider (free GPT-4.1 dev, paid OpenAI prod)
  - Added all 6 UI states (empty, loading, success, error, timeout, parse failure)
  - Added anti-hallucination requirements
  - Added Algolia visibility elements
  - Replaced follow-up chat with batch analysis stretch goal
  - Added red herring policies
  - Shifted system prompt drafting to Day 0
- Created features.json v1 (20 features across 6 phases)
- Created init.sh and this progress file
- Ran feature list audit (third audit)
- Updated features.json v2 (23 features) addressing all critical/high findings:
  - Split F05 (system prompt tuning) into 3 sub-features: scenarios 1&2, 3&4, consistency pass
  - Added F09: TypeScript types + demo ticket data + mock parsed verdicts (foundation phase)
  - Added F12: Two-panel layout shell with state management and conditional rendering
  - Merged empty/onboarding state into layout shell (F12)
  - Added preconditions to F20 (integration) and F23 (submission)
  - Fixed F16→F19: timing label says "Analysis completed" not "Policies retrieved"
  - Added F07 step: save sample XML outputs as mock data for frontend
  - Added F07 step: begin submission post skeleton (submission-draft.md)
  - All verification steps now labeled Manual/Automated where appropriate
  - Added error-case testing to F11 (API route)
  - Added go/no-go decision criteria to F03

KEY DECISIONS:
- Track: Non-Conversational (less competitive, proactive workflow enhancement)
- No chat widget of any kind (weakens non-conversational positioning)
- XML tags for structured output (more reliable than section headers)
- Next.js API route proxy (keeps keys server-side, avoids CORS issues)
- policy_layer numeric field (1-4) for deterministic conflict resolution
- Temperature=0 for demo reliability

BLOCKED ON:
- Nothing. Ready to start spike (F01).

KEY RISKS IDENTIFIED:
- Multi-step retrieval may not work in Agent Studio (validate in F03)
- XML output parsing may be fragile (validate in F03)
- Day 1 is ~9-13 hours of work (system prompt iteration is biggest time sink)
- LLM rate limits during judging if using Gemini free tier (use paid OpenAI)

DISCOVERIES:
- Algolia provides free GPT-4.1 access for development
- Vercel AI SDK compatible via compatibilityMode=ai-sdk-5
- Agent Studio is in beta — docs may be incomplete
- Gemini free tier rate limits reduced to 5-15 RPM (tighter than expected)
- Previous hackathon winners were all non-obvious use cases

FILES IN REPO:
- SPEC.md — comprehensive project specification (source of truth)
- features.json — feature list with verification steps (coding agent contract)
- init.sh — dev environment boot script
- claude-progress.txt — this file
- hackathon.md — original hackathon brief
- rough_idea.md — original project idea

===

SESSION 1 STATUS: COMPLETE (planning phase done)

===

NEXT SESSION SHOULD:
1. Read this file and features.json for context
2. Algolia account is confirmed accessible with Agent Studio available
3. Start F01: Create apex_gear_policies index, configure attributes, push 5-6 test records
4. Then F02: Create Agent Studio agent, configure LLM provider (check what's available in the dashboard — OpenAI, Gemini, or Algolia's free GPT-4.1), write system prompt v1
5. Then F03: Go/no-go spike validation — multi-step retrieval, XML output, consistency
6. Goal: complete F01-F03 (spike phase) this session. If spike passes, optionally start F04 (full dataset)
7. LLM provider decision: use whatever is available and reliable. Key: must support temperature=0 and not rate-limit during judging. Paid key preferred for production.

===

SESSION 2 — 2026-02-05 (Day 0, Spike + Data + Frontend + Integration)

COMPLETED:
- F01: Algolia index setup — pushed 6 test records, configured searchable/faceting/ranking attributes
- F02: Agent Studio setup — system prompt v1, manual dashboard config, validated /completions API
  - Key API learnings: URL is /agent-studio/1/agents/{ID}/completions, needs compatibilityMode=ai-sdk-5
  - Message format: { messages: [{ role: 'user', parts: [{ type: 'text', text: '...' }] }] }
  - Response is SSE, text-delta events use field name "delta" (not "textDelta")
- F03: Spike validation — GO decision. Multi-step retrieval works (3 searches), XML parses 100%
  - Initial verdicts were ESCALATE due to facet_filters mismatch; fixed in system prompt v2
- F04: Full dataset — 26 records across 4 layers (L1=9, L2=6, L3=5, L4=6), pushed to Algolia
- F05: System prompt tuning — S1 (APPROVED 3/3) and S2 (DENIED 3/3)
  - Added "no facet_filters" rule and conflict detection improvements
- F06: System prompt tuning — S3 (APPROVED 3/3) and S4 (APPROVED 3/3), no changes needed
- F07: Consistency pass — 20/20 perfect (5 runs x 4 scenarios)
  - Saved 4 sample XML responses, created submission-draft.md skeleton
- F08: Next.js scaffolding with Tailwind v4, TypeScript strict, .env.example
- F09: Types (PolicyRecord, ParsedVerdict, DemoTicket, AnalysisState), 4 demo tickets, 4 mock verdicts
- F10: XML parser with 10 passing vitest tests
- F11: API route proxy (/api/analyze) with SSE parsing, 30s timeout, error handling
- F12: Two-panel layout shell with full state management (6 states), onboarding panel
- F13-F19: All UI components — TicketQueue, LoadingState, VerdictCard, PolicyCards, ConflictTrace, ErrorState, AlgoliaAttribution
  - Dark "command center" aesthetic: DM Sans + JetBrains Mono, emerald/crimson/amber palette
- F20: Integration verified — all 4 scenarios pass end-to-end through live Agent Studio API
  - S1: APPROVED (warranty override, 5 policies, conflict detected)
  - S2: DENIED (hygiene block, conflict detected)
  - S3: APPROVED (damage override, 6 policies, conflict detected)
  - S4: APPROVED (standard return, 6 policies, no conflict)
- F22: Visual polish — focus states, effect display, screenshots directory

KEY DECISIONS:
- Used algoliasearch v5 API (not v4)
- Agent Studio uses GPT-4.1 (free from Algolia)
- SSE stream parsing (not JSON response) for /completions
- System prompt v2: no facet_filters, evaluate policies independently for conflict detection
- Tailwind v4 with @theme block for custom colors
- DM Sans + JetBrains Mono font pairing

REMAINING (F21, F23):
- F21: Deploy to Vercel — GitHub repo created (https://github.com/bug39/policypilot), Vercel CLI installed
  - BLOCKED: Need user to run `vercel login` and `vercel --prod`
  - Env vars needed: ALGOLIA_APP_ID, ALGOLIA_SEARCH_API_KEY, ALGOLIA_AGENT_ID
- F23: Finalize dev.to submission post — submission-draft.md skeleton exists
  - Needs: live URL, screenshots, finalized content for all 4 sections

===

SESSION 2 STATUS: F01-F20 + F22 complete. Blocked on Vercel deploy (F21) and submission (F23).
